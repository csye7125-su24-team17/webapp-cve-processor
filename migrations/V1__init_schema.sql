-- Create schema if it does not exist
CREATE SCHEMA IF NOT EXISTS cve;

CREATE TABLE cve_records (
    id SERIAL PRIMARY KEY,
    cve_id VARCHAR(255),
    data JSONB,
    date_published TIMESTAMP,
    date_updated TIMESTAMP,
    version INT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE (cve_id, version)
);

-- Create indexes for better performance on JSONB
CREATE INDEX idx_cve_id ON cve_records (cve_id);
CREATE INDEX idx_date_updated ON cve_records (date_updated);
CREATE INDEX idx_json_data ON cve_records USING gin (data);